<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Dev_hj</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">













<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>



</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">归档</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="Download" href="https://github.com/HJMengx/">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/06/22/Flutter_scoped_model源码阅读/" itemprop="url">scoped_model 源码阅读</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-06-22T14:35:16.004Z" itemprop="datePublished">Jun 22 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            14 minutes read (About 2093 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p><code>最近做的项目有一个需求, 就是有不同的主题, 那么在设置页面就应该让生效, 这就是全局状态的一个管理了, Flutter 系统提供了 InheritedWidget, 但是这里我们来使用 scoped_model(基于InheritedWidget进行了封装)</code>.</p>
<h4 id="InheritedWidget"><a href="#InheritedWidget" class="headerlink" title="InheritedWidget"></a>InheritedWidget</h4><p>我们先来看一下<code>InheritedWidget</code>是如何实现共享数据的.</p>
<p><code>以下是官网上的一个小例子</code></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareDataWidget</span> <span class="keyword">extends</span> <span class="title">InheritedWidget</span> </span>&#123;</span><br><span class="line">  ShareDataWidget(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.data,</span><br><span class="line">    Widget child</span><br><span class="line">  &#125;) :<span class="keyword">super</span>(child: child);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> data; <span class="comment">//需要在子树中共享的数据，保存点击次数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//定义一个便捷方法，方便子树中的widget获取共享数据  </span></span><br><span class="line">  <span class="keyword">static</span> ShareDataWidget of(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> context.inheritFromWidgetOfExactType(ShareDataWidget);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//该回调决定当data发生变化时，是否通知子树中依赖data的Widget  </span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> updateShouldNotify(ShareDataWidget old) &#123;</span><br><span class="line">    <span class="comment">//如果返回true，则子树中依赖(build函数中有调用)本widget</span></span><br><span class="line">    <span class="comment">//的子widget的`state.didChangeDependencies`会被调用</span></span><br><span class="line">    <span class="keyword">return</span> old.data != data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_TestWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  __TestWidgetState createState() =&gt; <span class="keyword">new</span> __TestWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">__TestWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">_TestWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//使用InheritedWidget中的共享数据</span></span><br><span class="line">    <span class="keyword">return</span> Text(ShareDataWidget</span><br><span class="line">        .of(context)</span><br><span class="line">        .data</span><br><span class="line">        .toString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> didChangeDependencies() &#123;</span><br><span class="line">    <span class="keyword">super</span>.didChangeDependencies();</span><br><span class="line">    <span class="comment">//父或祖先widget中的InheritedWidget改变(updateShouldNotify返回true)时会被调用。</span></span><br><span class="line">    <span class="comment">//如果build中没有依赖InheritedWidget，则此回调不会被调用。</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Dependencies change"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InheritedWidgetTestRoute</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _InheritedWidgetTestRouteState createState() =&gt; <span class="keyword">new</span> _InheritedWidgetTestRouteState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_InheritedWidgetTestRouteState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">InheritedWidgetTestRoute</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span>  Center(</span><br><span class="line">      child: ShareDataWidget( <span class="comment">//使用ShareDataWidget</span></span><br><span class="line">        data: count,</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.only(bottom: <span class="number">20.0</span>),</span><br><span class="line">              child: _TestWidget(),<span class="comment">//子widget中依赖ShareDataWidget</span></span><br><span class="line">            ),</span><br><span class="line">            RaisedButton(</span><br><span class="line">              child: Text(<span class="string">"Increment"</span>),</span><br><span class="line">              <span class="comment">//每点击一次，将count自增，然后重新build,ShareDataWidget的data将被更新  </span></span><br><span class="line">              onPressed: () =&gt; setState(() =&gt; ++count),</span><br><span class="line">            )</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里需要注意:</strong></p>
<ul>
<li><code>context.inheritFromWidgetOfExactType(ShareDataWidget)</code>来获取到指定<code>InheritedWidget</code>中的数据, 实际通知的时候是父Widget往下传递还是子Widget往上遍历呢?</li>
</ul>
<p><strong>接下lai 探索原因</strong></p>
<p><code>InheritedWidget</code>的源码很简单, 继承了<code>ProxyWidget</code>, 也没有实现太多逻辑, 对<code>createElement</code>进行了实现, 还定义了<code>updateShouldNotify</code>, 该方法的意思就是更新的时候是否应该通知在 <code>build</code> 阶段通过<code>inheritFromWidgetOfExactType</code>查找该 <code>Widget</code> 的子 <code>Widget</code>.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritedWidget</span> <span class="keyword">extends</span> <span class="title">ProxyWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> InheritedWidget(&#123; Key key, Widget child &#125;)</span><br><span class="line">    : <span class="keyword">super</span>(key: key, child: child);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  InheritedElement createElement() =&gt; InheritedElement(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">bool</span> updateShouldNotify(covariant InheritedWidget oldWidget);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>顺藤摸瓜, 我们去就去看<code>InheritedElement(this)</code>做了什么, 进去之后我们可以发现<code>_updateInheritance</code>方法.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _updateInheritance() &#123;</span><br><span class="line">  <span class="keyword">assert</span>(_active);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">Type</span>, InheritedElement&gt; incomingWidgets = _parent?._inheritedWidgets;</span><br><span class="line">  <span class="keyword">if</span> (incomingWidgets != <span class="keyword">null</span>)</span><br><span class="line">    _inheritedWidgets = HashMap&lt;<span class="built_in">Type</span>, InheritedElement&gt;.from(incomingWidgets);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    _inheritedWidgets = HashMap&lt;<span class="built_in">Type</span>, InheritedElement&gt;();</span><br><span class="line">  _inheritedWidgets[widget.runtimeType] = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时我们对比一下普通的<code>Element</code>的该方法实现, 只是简单的将父<code>Element</code>的<code>_inheritedWidgets</code>属性保存到自身(这样就保证了父级的向子集传递特性).</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _updateInheritance() &#123;</span><br><span class="line">  <span class="keyword">assert</span>(_active);</span><br><span class="line">  _inheritedWidgets = _parent?._inheritedWidgets;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个<code>_inheritedWidgets</code>属性又是在哪里出现呢? 它定义在 <code>Element</code>中, 每一个实例都有这个属性. 它的作用是存储上级节点<code>Widget</code>和<code>Element</code>之间的映射.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Element</span> <span class="keyword">extends</span> <span class="title">DiagnosticableTree</span> <span class="keyword">implements</span> <span class="title">BuildContext</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Creates an element that uses the given widget as its configuration.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Typically called by an override of [Widget.createElement].</span></span><br><span class="line">  <span class="built_in">Element</span>(Widget widget)</span><br><span class="line">    : <span class="keyword">assert</span>(widget != <span class="keyword">null</span>),</span><br><span class="line">      _widget = widget;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Element</span> _parent;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">Type</span>, InheritedElement&gt; _inheritedWidgets;</span><br></pre></td></tr></table></figure>

<p>现在我们回到<code>InheritedElement</code>的实现.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _updateInheritance() &#123;</span><br><span class="line">  <span class="keyword">assert</span>(_active);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">Type</span>, InheritedElement&gt; incomingWidgets = _parent?._inheritedWidgets;</span><br><span class="line">  <span class="keyword">if</span> (incomingWidgets != <span class="keyword">null</span>)</span><br><span class="line">    _inheritedWidgets = HashMap&lt;<span class="built_in">Type</span>, InheritedElement&gt;.from(incomingWidgets);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    _inheritedWidgets = HashMap&lt;<span class="built_in">Type</span>, InheritedElement&gt;();</span><br><span class="line">  <span class="comment">// 添加</span></span><br><span class="line">  _inheritedWidgets[widget.runtimeType] = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InheritedElement</code>会将自身的信息添加到<code>_inheritedWidgets</code>属性中, 然后子孙都可以通过他们自身的该属性访问当前的<code>InheritedElement</code>了.</p>
<p><strong>现在我们知道如何访问_inheritedWidgets属性以及包含的内容了, 那么通知机制是如何实现呢?</strong></p>
<p>一开始例子中就是使用<code>inheritFromWidgetOfExactType(Type)</code>方法去获取到指定的<code>InherientWidget</code>的, 那么这个方法是怎么实现呢?</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">InheritedWidget inheritFromWidgetOfExactType(<span class="built_in">Type</span> targetType, &#123; <span class="built_in">Object</span> aspect &#125;) &#123;</span><br><span class="line">  <span class="keyword">assert</span>(_debugCheckStateIsActiveForAncestorLookup());</span><br><span class="line">  <span class="keyword">final</span> InheritedElement ancestor = _inheritedWidgets == <span class="keyword">null</span> ? <span class="keyword">null</span> : _inheritedWidgets[targetType];</span><br><span class="line">  <span class="keyword">if</span> (ancestor != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">assert</span>(ancestor <span class="keyword">is</span> InheritedElement);</span><br><span class="line">    <span class="keyword">return</span> inheritFromElement(ancestor, aspect: aspect);</span><br><span class="line">  &#125;</span><br><span class="line">  _hadUnsatisfiedDependencies = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">InheritedWidget inheritFromElement(InheritedElement ancestor, &#123; <span class="built_in">Object</span> aspect &#125;) &#123;</span><br><span class="line">  <span class="keyword">assert</span>(ancestor != <span class="keyword">null</span>);</span><br><span class="line">  _dependencies ??= HashSet&lt;InheritedElement&gt;();</span><br><span class="line">  _dependencies.add(ancestor);</span><br><span class="line">  ancestor.updateDependencies(<span class="keyword">this</span>, aspect);</span><br><span class="line">  <span class="keyword">return</span> ancestor.widget;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先会获取<code>Element(Context)</code>的<code>_inheritedWidgets</code>指定类型的<code>Element</code>, 如果获取到了, 则会添加到自身的依赖列表中, 祖先节点也有记录这个依赖, 这样在更新时候就可以直接通过<code>_dependencies</code>属性来进行通知了.</p>
<p>每一次<code>InherientElement</code>更新的时候, 都会调用<code>notifyClients</code>方法来通知子节点, 调用子节点的<code>didChangeDependencies</code>方法</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> notifyClients(InheritedWidget oldWidget) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!widget.updateShouldNotify(oldWidget))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">assert</span>(_debugCheckOwnerBuildTargetExists(<span class="string">'notifyClients'</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">Element</span> dependent <span class="keyword">in</span> _dependents) &#123;</span><br><span class="line">    <span class="keyword">assert</span>(() &#123;</span><br><span class="line">      <span class="comment">// check that it really is our descendant</span></span><br><span class="line">      <span class="built_in">Element</span> ancestor = dependent._parent;</span><br><span class="line">      <span class="keyword">while</span> (ancestor != <span class="keyword">this</span> &amp;&amp; ancestor != <span class="keyword">null</span>)</span><br><span class="line">        ancestor = ancestor._parent;</span><br><span class="line">      <span class="keyword">return</span> ancestor == <span class="keyword">this</span>;</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="comment">// check that it really depends on us</span></span><br><span class="line">    <span class="keyword">assert</span>(dependent._dependencies.contains(<span class="keyword">this</span>));</span><br><span class="line">    dependent.didChangeDependencies();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是<code>InherientWidget</code>的原理, 接下来就是看看<code>scoped_model</code>做了怎样的封装.</p>
<h4 id="scoped-model"><a href="#scoped-model" class="headerlink" title="scoped_model"></a>scoped_model</h4><p>该库主要的类有:</p>
<h5 id="abstract-class-Model-extends-Listenable"><a href="#abstract-class-Model-extends-Listenable" class="headerlink" title="abstract class Model extends Listenable"></a><code>abstract class Model extends Listenable</code></h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> <span class="keyword">extends</span> <span class="title">Listenable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Set</span>&lt;VoidCallback&gt; _listeners = <span class="built_in">Set</span>&lt;VoidCallback&gt;();</span><br><span class="line">  <span class="built_in">int</span> _version = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> _microtaskVersion = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> addListener(VoidCallback listener) &#123;</span><br><span class="line">    debugPrint(<span class="string">"添加监听器"</span>);</span><br><span class="line">    listener();</span><br><span class="line">    _listeners.add(listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> removeListener(VoidCallback listener) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"监听器被去除"</span>);</span><br><span class="line">    _listeners.remove(listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> <span class="keyword">get</span> listenerCount =&gt; _listeners.length;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="keyword">void</span> notifyListeners() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_microtaskVersion == _version) &#123;</span><br><span class="line">      _microtaskVersion++;</span><br><span class="line">      scheduleMicrotask(() &#123;</span><br><span class="line">        _version++;</span><br><span class="line">        _microtaskVersion = _version;</span><br><span class="line">        _listeners.toList().forEach((VoidCallback listener) =&gt; listener());</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Model</code>继承了<code>Listenable</code>, 值在改变的时候调用<code>notifyListeners</code>既可以通知到所有的监听器.</p>
<h5 id="class-ScopedModel-lt-T-extends-Model-gt-extends-StatelessWidget"><a href="#class-ScopedModel-lt-T-extends-Model-gt-extends-StatelessWidget" class="headerlink" title="class ScopedModel&lt;T extends Model&gt; extends StatelessWidget"></a><code>class ScopedModel&lt;T extends Model&gt; extends StatelessWidget</code></h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScopedModel</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&gt; <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> T model;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line"></span><br><span class="line">  ScopedModel(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.model, <span class="meta">@required</span> <span class="keyword">this</span>.child&#125;)</span><br><span class="line">      : <span class="keyword">assert</span>(model != <span class="keyword">null</span>),</span><br><span class="line">        <span class="keyword">assert</span>(child != <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> AnimatedBuilder(</span><br><span class="line">      animation: model,</span><br><span class="line">      builder: (context, _) =&gt; _InheritedModel&lt;T&gt;(model: model, child: child),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 找到 ScopeModel, 并且让子节点和祖先节点建立依赖</span></span><br><span class="line">  <span class="keyword">static</span> T of&lt;T <span class="keyword">extends</span> Model&gt;(</span><br><span class="line">    BuildContext context, &#123;</span><br><span class="line">    <span class="built_in">bool</span> rebuildOnChange = <span class="keyword">false</span>,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">Type</span> type = _type&lt;_InheritedModel&lt;T&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    Widget widget = rebuildOnChange</span><br><span class="line">        ? context.inheritFromWidgetOfExactType(type)</span><br><span class="line">        : context.ancestorInheritedElementForWidgetOfExactType(type)?.widget;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (widget == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ScopedModelError();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (widget <span class="keyword">as</span> _InheritedModel&lt;T&gt;).model;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Type</span> _type&lt;T&gt;() =&gt; T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>通知方法</strong></p>
<p>作者在构造<code>ScopedModel</code>的时候, 使用了<code>AnimationBuilder</code>, 这里会注册一个监听器到 <code>Model</code>中, 然后每一次值的改变都会调用<code>AnimationBuilder.builder</code>方法, 然后就会触发<code>InherientWidget</code>的改变, 根据<code>updateShouldNotify</code>来决定是否通知子孙控件更新, 但是在这里我们并没有看到<code>InherientWidget</code>的影子, 让我们接着往下看.</p>
<h5 id="class-InheritedModel-lt-T-extends-Model-gt-extends-InheritedWidget"><a href="#class-InheritedModel-lt-T-extends-Model-gt-extends-InheritedWidget" class="headerlink" title="class _InheritedModel&lt;T extends Model&gt; extends InheritedWidget"></a><code>class _InheritedModel&lt;T extends Model&gt; extends InheritedWidget</code></h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_InheritedModel</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&gt; <span class="keyword">extends</span> <span class="title">InheritedWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> T model;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> version;</span><br><span class="line"></span><br><span class="line">  _InheritedModel(&#123;Key key, Widget child, T model&#125;)</span><br><span class="line">      : <span class="keyword">this</span>.model = model,</span><br><span class="line">        <span class="keyword">this</span>.version = model._version,</span><br><span class="line">        <span class="keyword">super</span>(key: key, child: child);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> updateShouldNotify(_InheritedModel&lt;T&gt; oldWidget) =&gt;</span><br><span class="line">      (oldWidget.version != version);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到这个类, 我们就可以发现作者的实现方式了, <code>_InheritedModel</code>继承自<code>InheritedWidget</code>, 上方<code>ScopedModel.build()</code>方法, 里面就返回了该<code>inherientWidget</code>对象, 但是与上方的例子还缺少子类对父类进行依赖的一步. </p>
<h5 id="class-ScopedModelDescendant-lt-T-extends-Model-gt-extends-StatelessWidget"><a href="#class-ScopedModelDescendant-lt-T-extends-Model-gt-extends-StatelessWidget" class="headerlink" title="class ScopedModelDescendant&lt;T extends Model&gt; extends StatelessWidget"></a><code>class ScopedModelDescendant&lt;T extends Model&gt; extends StatelessWidget</code></h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Widget ScopedModelDescendantBuilder&lt;T <span class="keyword">extends</span> Model&gt;(</span><br><span class="line">  BuildContext context,</span><br><span class="line">  Widget child,</span><br><span class="line">  T model,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScopedModelDescendant</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&gt; <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ScopedModelDescendantBuilder&lt;T&gt; builder;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> rebuildOnChange;</span><br><span class="line"></span><br><span class="line">  ScopedModelDescendant(&#123;</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.builder,</span><br><span class="line">    <span class="keyword">this</span>.child,</span><br><span class="line">    <span class="keyword">this</span>.rebuildOnChange = <span class="keyword">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> builder(</span><br><span class="line">      context,</span><br><span class="line">      child,</span><br><span class="line">      ScopedModel.of&lt;T&gt;(context, rebuildOnChange: rebuildOnChange),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ScopedModelDescendant</code>就是<code>ScopedModel</code>的子孙, 那么可以看到它的 <code>Build</code>方法,  里面有调用<code>ScopedModel.of&lt;T&gt;(context, rebuildOnChange: rebuildOnChange)</code>, 我们把这个方法在拿出来看一下:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> T of&lt;T <span class="keyword">extends</span> Model&gt;(</span><br><span class="line">  BuildContext context, &#123;</span><br><span class="line">  <span class="built_in">bool</span> rebuildOnChange = <span class="keyword">false</span>,</span><br><span class="line">&#125;) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Type</span> type = _type&lt;_InheritedModel&lt;T&gt;&gt;();</span><br><span class="line"></span><br><span class="line">  Widget widget = rebuildOnChange</span><br><span class="line">      ? context.inheritFromWidgetOfExactType(type)</span><br><span class="line">      : context.ancestorInheritedElementForWidgetOfExactType(type)?.widget;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (widget == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> ScopedModelError();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (widget <span class="keyword">as</span> _InheritedModel&lt;T&gt;).model;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">Type</span> _type&lt;T&gt;() =&gt; T;</span><br></pre></td></tr></table></figure>

<p>到这里, 就可以发现它和<code>inherient</code>做法相同了, 首先获取到<code>InheritedWidget</code>的类型, <code>_type&lt;_InheritedModel&lt;T&gt;&gt;()</code>得到<code>_InheritedModel&lt;T&gt;</code>, 然后判断是否需要在改变的时候重绘, 默认是<code>True</code>, 如果需要重绘就会调用<code>inheritFromWidgetOfExactType</code>去建立依赖, 如果为<code>false</code>, 则会调用<code>ancestorInheritedElementForWidgetOfExactType</code>, 这个方法不会建立依赖, 所以在改变的时候不会收到通知并重绘, 官方的注释有这么一句:<br><strong>This method does not establish a relationship with the target in the way that [inheritFromWidgetOfExactType] does.</strong></p>
<h5 id="最后贴一下作者提供的小例子"><a href="#最后贴一下作者提供的小例子" class="headerlink" title="最后贴一下作者提供的小例子"></a>最后贴一下作者提供的小例子</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:scoped_model/scoped_model.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  CounterModel model = CounterModel();</span><br><span class="line">  runApp(MyApp(</span><br><span class="line">    model: model,</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> CounterModel model;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key key, <span class="meta">@required</span> <span class="keyword">this</span>.model&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// At the top level of our app, we'll, create a ScopedModel Widget. This</span></span><br><span class="line">    <span class="comment">// will provide the CounterModel to all children in the app that request it</span></span><br><span class="line">    <span class="comment">// using a ScopedModelDescendant.</span></span><br><span class="line">    <span class="keyword">return</span> ScopedModel&lt;CounterModel&gt;(</span><br><span class="line">      model: model,</span><br><span class="line">      child: MaterialApp(</span><br><span class="line">        title: <span class="string">'Scoped Model Demo'</span>,</span><br><span class="line">        home: CounterHome(<span class="string">'Scoped Model Demo'</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start by creating a class that has a counter and a method to increment it.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note: It must extend from Model.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterModel</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> <span class="keyword">get</span> counter =&gt; _counter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> increment() &#123;</span><br><span class="line">    <span class="comment">// First, increment the counter</span></span><br><span class="line">    _counter++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then notify all the listeners.</span></span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterHome</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line"></span><br><span class="line">  CounterHome(<span class="keyword">this</span>.title);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(title),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(<span class="string">'You have pushed the button this many times:'</span>),</span><br><span class="line">            <span class="comment">// Create a ScopedModelDescendant. This widget will get the</span></span><br><span class="line">            <span class="comment">// CounterModel from the nearest parent ScopedModel&lt;CounterModel&gt;.</span></span><br><span class="line">            <span class="comment">// It will hand that CounterModel to our builder method, and</span></span><br><span class="line">            <span class="comment">// rebuild any time the CounterModel changes (i.e. after we</span></span><br><span class="line">            <span class="comment">// `notifyListeners` in the Model).</span></span><br><span class="line">            ScopedModelDescendant&lt;CounterModel&gt;(</span><br><span class="line">              builder: (context, child, model) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(</span><br><span class="line">                  model.counter.toString(),</span><br><span class="line">                  style: Theme.of(context).textTheme.display1,</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      <span class="comment">// Use the ScopedModelDescendant again in order to use the increment</span></span><br><span class="line">      <span class="comment">// method from the CounterModel</span></span><br><span class="line">      floatingActionButton: ScopedModelDescendant&lt;CounterModel&gt;(</span><br><span class="line">        builder: (context, child, model) &#123;</span><br><span class="line">          <span class="keyword">return</span> FloatingActionButton(</span><br><span class="line">            onPressed: model.increment,</span><br><span class="line">            tooltip: <span class="string">'Increment'</span>,</span><br><span class="line">            child: Icon(Icons.add),</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里也能验证我们上方所分析的, 首先需要构建 <code>ScopedModel</code>, 然后共享状态的子孙节点通过<code>ScopedModelDescendant</code>来添加.</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/06/21/Flutter_完成一个图片APP/" itemprop="url">Flutter-完成一个图片APP</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-06-21T12:47:36.271Z" itemprop="datePublished">Jun 21 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            12 minutes read (About 1782 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>自从 <code>Flutter</code> 推出之后, 一直是备受关注, 有看好的也有不看好的, 作为移动开发人员自然是要尝试一下的(但是它的嵌套写法真的难受), 本着学一个东西, 就一定要动手的态度, 平时又喜欢看一些猫狗的图片, 就想着做一个加载猫狗图片你的 APP, 界面图如下(界面不是很好看).</p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g44jzny6jvj30u01szkjs.jpg" alt></p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g44k0aw8qmj30u01szu13.jpg" alt></p>
<p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g44k0pm323j30u01szx6u.jpg" alt></p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g44k0uqo5oj30u01sznpd.jpg" alt></p>
<h4 id="主要模块"><a href="#主要模块" class="headerlink" title="主要模块"></a>主要模块</h4><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g454p3y9ozj31j90u0q8a.jpg" alt></p>
<h5 id="NetWork"><a href="#NetWork" class="headerlink" title="NetWork"></a>NetWork</h5><p><code>api.dart</code>文件中, 分别定义了<code>DogApi, CatApi</code>两个类, 一个用于处理获取猫的图片的类, 一个用于处理狗的图片的类.</p>
<p><code>http_request.dart</code>文件封装了<code>Http</code>请求, 用于发送和接收数据.</p>
<p><code>url.dart</code>文件封装了需要用到的<code>Api</code>接口, 主要是为了方便和统一管理而编写.</p>
<p><code>Models</code>文件夹下分别定义不同<code>API</code>接口返回数据的模型. </p>
<h5 id="图片页"><a href="#图片页" class="headerlink" title="图片页"></a>图片页</h5><p>瀑布流使用的<code>flutter_staggered_grid_view</code>库, 作者自定义了<code>Delegate</code>计算布局, 使用起来非常简单.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Widget scene = <span class="keyword">new</span> StaggeredGridView.countBuilder(</span><br><span class="line">      physics: BouncingScrollPhysics(),</span><br><span class="line">      itemCount: <span class="keyword">this</span>.breedImgs != <span class="keyword">null</span> ? <span class="keyword">this</span>.breedImgs.urls.length : <span class="number">0</span>,</span><br><span class="line">      mainAxisSpacing: <span class="number">4.0</span>,</span><br><span class="line">      crossAxisSpacing: <span class="number">4.0</span>,</span><br><span class="line">      crossAxisCount: <span class="number">3</span>,</span><br><span class="line">      itemBuilder: (context, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> GestureDetector(</span><br><span class="line">          onTapUp: (TapUpDetails detail) &#123;</span><br><span class="line">            <span class="comment">// 展示该品种的相关信息</span></span><br><span class="line">            <span class="keyword">dynamic</span> breed = <span class="keyword">this</span>.breeds[<span class="keyword">this</span>.selectedIdx].description;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 取出当前点击的然后所有往后的</span></span><br><span class="line">            <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; unreadImgs = <span class="keyword">new</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = index; i &lt; <span class="keyword">this</span>.breedImgs.urls.length; i++) &#123;</span><br><span class="line">              unreadImgs.add(<span class="keyword">this</span>.breedImgs.urls[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            AnimalImagesPage photoPage = <span class="keyword">new</span> AnimalImagesPage(</span><br><span class="line">              listImages: unreadImgs,</span><br><span class="line">              breed: <span class="keyword">this</span>.breeds[<span class="keyword">this</span>.selectedIdx].name,</span><br><span class="line">              imgType: <span class="string">"Cat"</span>,</span><br><span class="line">              petInfo: <span class="keyword">this</span>.breeds[<span class="keyword">this</span>.selectedIdx],</span><br><span class="line">            );</span><br><span class="line">            Navigator.of(context)</span><br><span class="line">                .push(<span class="keyword">new</span> MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">              <span class="keyword">return</span> photoPage;</span><br><span class="line">            &#125;));</span><br><span class="line">          &#125;,</span><br><span class="line">          child: <span class="keyword">new</span> Container(</span><br><span class="line">            width: <span class="number">100</span>,</span><br><span class="line">            height: <span class="number">100</span>,</span><br><span class="line">            color: Color(<span class="number">0xFF2FC77D</span>), <span class="comment">//Colors.blueAccent,</span></span><br><span class="line">            child: <span class="keyword">new</span> CachedNetworkImage(</span><br><span class="line">              imageUrl: <span class="keyword">this</span>.breedImgs.urls[index],</span><br><span class="line">              fit: BoxFit.fill,</span><br><span class="line">              placeholder: (context, index) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Center(child: <span class="keyword">new</span> CupertinoActivityIndicator());</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 该属性可以控制当前 Cell 占用的空间大小, 用来实现瀑布的感觉</span></span><br><span class="line">      staggeredTileBuilder: (<span class="built_in">int</span> index) =&gt;</span><br><span class="line">          <span class="keyword">new</span> StaggeredTile.count(<span class="number">1</span>, index.isEven ? <span class="number">1.5</span> : <span class="number">1</span>),</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<ul>
<li>组装<code>PickerView</code></li>
</ul>
<p>系统默认的 <code>PickerView</code> 在每一次切换都会回调, 而且没有确定和取消事件,<br>如果直接使用会造成频繁的网络请求, 内存消耗也太快, 所以组装了一下, 增加确定和取消才去执行网络请求, 这样就解决了这个问题.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">Widget column = Column(</span><br><span class="line">  mainAxisSize: MainAxisSize.min,</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    <span class="keyword">new</span> Row(</span><br><span class="line">      mainAxisSize: MainAxisSize.min,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        <span class="keyword">new</span> Container(</span><br><span class="line">          width: MediaQuery.of(context).size.width,</span><br><span class="line">          height: <span class="number">40</span>,</span><br><span class="line">          child: <span class="keyword">new</span> Row(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">            children: &lt;Widget&gt;[</span><br><span class="line">              <span class="keyword">new</span> Padding(</span><br><span class="line">                padding: EdgeInsets.only(left: <span class="number">10.0</span>),</span><br><span class="line">                child: <span class="keyword">new</span> GestureDetector(</span><br><span class="line">                  onTapUp: (detail) &#123;</span><br><span class="line">                    <span class="comment">// 点击了确定按钮, 退出当前页面</span></span><br><span class="line">                    Navigator.of(context).pop();</span><br><span class="line">                    <span class="comment">// 回调操作</span></span><br><span class="line">                    <span class="keyword">this</span>.submit(<span class="keyword">this</span>.selectedIndex);</span><br><span class="line">                  &#125;,</span><br><span class="line">                  child: <span class="keyword">new</span> Text(</span><br><span class="line">                    <span class="string">"确定"</span>,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                        decoration: TextDecoration.none,</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                        fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              <span class="keyword">new</span> Padding(</span><br><span class="line">                padding: EdgeInsets.only(right: <span class="number">10.0</span>),</span><br><span class="line">                child: <span class="keyword">new</span> GestureDetector(</span><br><span class="line">                  onTapUp: (detail) &#123;</span><br><span class="line">                    <span class="comment">// 点击了确定按钮, 退出当前页面</span></span><br><span class="line">                    Navigator.of(context).pop();</span><br><span class="line">                  &#125;,</span><br><span class="line">                  child: <span class="keyword">new</span> Text(</span><br><span class="line">                    <span class="string">"取消"</span>,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                        decoration: TextDecoration.none,</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                        fontSize: <span class="number">18</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              )</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">    <span class="keyword">new</span> Container(</span><br><span class="line">      height: <span class="number">1</span>,</span><br><span class="line">      color: Colors.white,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">// Picker</span></span><br><span class="line">    <span class="keyword">new</span> Expanded(</span><br><span class="line">      child: <span class="keyword">new</span> CupertinoPicker.builder(</span><br><span class="line">          backgroundColor: Colors.transparent,</span><br><span class="line">          itemExtent: <span class="number">44</span>,</span><br><span class="line">          childCount: <span class="keyword">this</span>.names.length,</span><br><span class="line">          onSelectedItemChanged: (<span class="built_in">int</span> selected) &#123;</span><br><span class="line">            <span class="keyword">this</span>.selectedIndex = selected;</span><br><span class="line">            <span class="keyword">this</span>.onSelected(selected);</span><br><span class="line">          &#125;,</span><br><span class="line">          itemBuilder: (context, index) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Container(</span><br><span class="line">              width: <span class="number">160</span>,</span><br><span class="line">              height: <span class="number">44</span>,</span><br><span class="line">              alignment: Alignment.center,</span><br><span class="line">              child: <span class="keyword">new</span> Text(</span><br><span class="line">                <span class="keyword">this</span>.names[index],</span><br><span class="line">                textAlign: TextAlign.right,</span><br><span class="line">                style: <span class="keyword">new</span> TextStyle(</span><br><span class="line">                    color: Colors.white,</span><br><span class="line">                    fontSize: <span class="number">16</span>,</span><br><span class="line">                    decoration: TextDecoration.none),</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;),</span><br><span class="line">    )</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="详情页"><a href="#详情页" class="headerlink" title="详情页"></a>详情页</h5><ul>
<li><code>Column</code> 包含 <code>ListView</code></li>
</ul>
<p>详情页中, 上方是一个图片, 下方是关于品种的相关信息, <code>猫</code>下方是通过 <code>API</code>获取到的属性进行一个展示, 需要注意一点是, 如果<code>Column</code>封装了<code>MainAxis</code>相同方向的滚动控件, 必须设置<code>Width/Height</code>, 同理, <code>Row</code>也是需要注意这一点的.</p>
<p>我在这里的做法是通过一个<code>Container</code>包裹 <code>ListView</code>.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Container(</span><br><span class="line">    margin: EdgeInsets.only(bottom: <span class="number">10</span>, top: <span class="number">10</span>),</span><br><span class="line">    height: MediaQuery.of(context).size.height - MediaQuery.of(context).size.width / <span class="number">1.2</span> - <span class="number">80</span>,</span><br><span class="line">     width: MediaQuery.of(context).size.width,</span><br><span class="line">     child: listView,</span><br><span class="line">),</span><br></pre></td></tr></table></figure>

<ul>
<li>图片动画</li>
</ul>
<p>这一部分稍微复杂一些, 首先需要监听滑动的距离, 来对图片进行变换, 最后根据是否达到阈值来进行切换动画, 这里我没有实现在最后一张和第一张图片进行切换以至于可以无限循环滚动, 我在边界阈值上只是阻止了下一步动画.</p>
<p>动画我都是通过<code>Matrix4</code>来设置不同位置的属性, 它也能模拟出 <code>3D</code> 效果, </p>
<p>动画的变换都是<code>Tween</code>来管理.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _initAnimation() &#123;</span><br><span class="line">  <span class="comment">// 透明度动画</span></span><br><span class="line">  <span class="keyword">this</span>.opacityAnimation = <span class="keyword">new</span> Tween(begin: <span class="number">1.0</span>, end: <span class="number">0.0</span>).animate(</span><br><span class="line">      <span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">          parent: <span class="keyword">this</span>._nextAnimationController, curve: Curves.decelerate))</span><br><span class="line">    ..addListener(() &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(() &#123;</span><br><span class="line">        <span class="comment">// 通知 Fluter Engine 重绘</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">// 翻转动画</span></span><br><span class="line">  <span class="comment">// 第三个值是角度</span></span><br><span class="line">  <span class="keyword">var</span> startTrans = Matrix4.identity()..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.006</span>);</span><br><span class="line">  <span class="keyword">var</span> endTrans = Matrix4.identity()</span><br><span class="line">    ..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.006</span>)</span><br><span class="line">    ..rotateX(<span class="number">3.1415927</span>);</span><br><span class="line">  <span class="keyword">this</span>.transformAnimation = <span class="keyword">new</span> Tween(begin: startTrans, end: endTrans)</span><br><span class="line">      .animate(<span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">          parent: <span class="keyword">this</span>._nextAnimationController, curve: Curves.easeIn))</span><br><span class="line">        ..addListener(() &#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(() &#123;&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">  <span class="comment">// 缩放</span></span><br><span class="line">  <span class="keyword">var</span> saveStartTrans = Matrix4.identity()..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.006</span>);</span><br><span class="line">  <span class="comment">// 平移且缩放</span></span><br><span class="line">  <span class="keyword">var</span> saveEndTrans = Matrix4.identity()</span><br><span class="line">    ..setEntry(<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.006</span>)</span><br><span class="line">    ..scale(<span class="number">0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">    ..translate(<span class="number">-20.0</span>, <span class="number">20.0</span>); <span class="comment">// MediaQuery.of(context).size.height</span></span><br><span class="line">  <span class="keyword">this</span>.saveToPhotos = <span class="keyword">new</span> Tween(begin: saveStartTrans, end: saveEndTrans)</span><br><span class="line">      .animate(<span class="keyword">new</span> CurvedAnimation(</span><br><span class="line">          parent: <span class="keyword">this</span>._saveAnimationController, curve: Curves.easeIn))</span><br><span class="line">        ..addListener(() &#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(() &#123;&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Widget</code>引用这个属性来执行动画.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Widget pet = <span class="keyword">new</span> GestureDetector(</span><br><span class="line">      onVerticalDragUpdate: nextUpdate,</span><br><span class="line">      onVerticalDragStart: nextStart,</span><br><span class="line">      onVerticalDragEnd: next,</span><br><span class="line">      child: <span class="keyword">new</span> Transform(</span><br><span class="line">        transform: <span class="keyword">this</span>.dragUpdateTransform,</span><br><span class="line">        child: Container(</span><br><span class="line">          child: <span class="keyword">new</span> Transform(</span><br><span class="line">            alignment: Alignment.bottomLeft,</span><br><span class="line">            transform: transform,</span><br><span class="line">            child: <span class="keyword">new</span> Opacity(</span><br><span class="line">              opacity: opacity,</span><br><span class="line">              child: Container(</span><br><span class="line">                width: MediaQuery.of(context).size.width / <span class="number">1.2</span>,</span><br><span class="line">                height: MediaQuery.of(context).size.width / <span class="number">1.5</span> - <span class="number">30</span>,</span><br><span class="line">                child: <span class="keyword">new</span> Padding(</span><br><span class="line">                  padding: EdgeInsets.all(<span class="number">0</span>),</span><br><span class="line">                  child: <span class="keyword">new</span> CachedNetworkImage(</span><br><span class="line">                    imageUrl: <span class="keyword">this</span>.widget.listImages[item],</span><br><span class="line">                    fit: BoxFit.fill,</span><br><span class="line">                    placeholder: (context, content) &#123;</span><br><span class="line">                      <span class="keyword">return</span> <span class="keyword">new</span> Container(</span><br><span class="line">                        width: MediaQuery.of(context).size.width / <span class="number">2.0</span> - <span class="number">40</span>,</span><br><span class="line">                        height: MediaQuery.of(context).size.width / <span class="number">2.0</span> - <span class="number">60</span>,</span><br><span class="line">                        color: Color(<span class="number">0xFF2FC77D</span>),</span><br><span class="line">                        child: <span class="keyword">new</span> Center(</span><br><span class="line">                          child: <span class="keyword">new</span> CupertinoActivityIndicator(),</span><br><span class="line">                        ),</span><br><span class="line">                      );</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<h6 id="Firebase-admob"><a href="#Firebase-admob" class="headerlink" title="Firebase_admob"></a>Firebase_admob</h6><p><strong>注意: 这里需要去 firebase 官网注册 APP, 然后分别下载 iOS, Android 的配置文件放到指定的位置, 否则程序启动的时候会闪退.</strong></p>
<p><strong>iOS info.plist: GADApplicationIdentifier也需要配置, 虽然在 Dart 中会启动的时候就注册ID, 但是这里也别忘了配置.</strong></p>
<p><strong>Android Manifst.xml 也需要配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag"> <span class="attr">android:name</span>=<span class="string">"com.google.android.gms.ads.APPLICATION_ID"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">android:value</span>=<span class="string">""</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>这里说一下我因为个人编码导致的问题, 我尝试自己来控制广告展示, 加了一个读秒跳过按钮(想强制观看一段时间), 点击跳过设置setState, 但是在 build 方法中又请求了广告, 导致了一个死循环, 最后由于请求次数过多还没有设置自己的设备为测试设备也不是使用的测试ID, 账号被暂停了, 所以大家使用的时候要避免这个问题, 尽量还是将自己的设备添加到测试设备中.</code></p>
<p>使用的话比较简单(官方的演示代码直接复制也可以用).</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdPage</span> </span>&#123;</span><br><span class="line">  MobileAdTargetingInfo targetingInfo;</span><br><span class="line"></span><br><span class="line">  InterstitialAd interstitial;</span><br><span class="line"></span><br><span class="line">  BannerAd banner;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> initAttributes() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.targetingInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.targetingInfo = MobileAdTargetingInfo(</span><br><span class="line">          keywords: [<span class="string">"some keyword for your app"</span>],</span><br><span class="line">          <span class="comment">// 防止被Google 认为是无效点击和展示.</span></span><br><span class="line">          testDevices: [<span class="string">"Your Phone"</span>, <span class="string">"Simulator"</span>]);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">bool</span> android = Platform.isAndroid;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.interstitial = InterstitialAd(</span><br><span class="line">        adUnitId: InterstitialAd.testAdUnitId,</span><br><span class="line">        targetingInfo: <span class="keyword">this</span>.targetingInfo,</span><br><span class="line">        listener: (MobileAdEvent event) &#123;</span><br><span class="line">          <span class="keyword">if</span> (event == MobileAdEvent.closed) &#123;</span><br><span class="line">            <span class="comment">// 点击关闭</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"InterstitialAd Closed"</span>);</span><br><span class="line">            <span class="keyword">this</span>.interstitial.dispose();</span><br><span class="line">            <span class="keyword">this</span>.interstitial = <span class="keyword">null</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event == MobileAdEvent.clicked) &#123;</span><br><span class="line">            <span class="comment">// 关闭</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"InterstitialAd Clicked"</span>);</span><br><span class="line">            <span class="keyword">this</span>.interstitial.dispose();</span><br><span class="line">            <span class="keyword">this</span>.interstitial = <span class="keyword">null</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event == MobileAdEvent.loaded) &#123;</span><br><span class="line">            <span class="comment">// 加载</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"InterstitialAd Loaded"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"InterstitialAd event is <span class="subst">$event</span>"</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="comment">//      this.banner = BannerAd(</span></span><br><span class="line"><span class="comment">//          targetingInfo: this.targetingInfo,</span></span><br><span class="line"><span class="comment">//          size: AdSize.smartBanner,</span></span><br><span class="line"><span class="comment">//          listener: (MobileAdEvent event) &#123;</span></span><br><span class="line"><span class="comment">//            if (event == MobileAdEvent.closed) &#123;</span></span><br><span class="line"><span class="comment">//              // 点击关闭</span></span><br><span class="line"><span class="comment">//              print("InterstitialAd Closed");</span></span><br><span class="line"><span class="comment">//              this.interstitial.dispose();</span></span><br><span class="line"><span class="comment">//              this.interstitial = null;</span></span><br><span class="line"><span class="comment">//            &#125; else if (event == MobileAdEvent.clicked) &#123;</span></span><br><span class="line"><span class="comment">//              // 关闭</span></span><br><span class="line"><span class="comment">//              print("InterstitialAd Clicked");</span></span><br><span class="line"><span class="comment">//              this.interstitial.dispose();</span></span><br><span class="line"><span class="comment">//              this.interstitial = null;</span></span><br><span class="line"><span class="comment">//            &#125; else if (event == MobileAdEvent.loaded) &#123;</span></span><br><span class="line"><span class="comment">//              // 加载</span></span><br><span class="line"><span class="comment">//              print("InterstitialAd Loaded");</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            print("InterstitialAd event is $event");</span></span><br><span class="line"><span class="comment">//          &#125;);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> show() &#123;</span><br><span class="line">    <span class="comment">// 初始化数据</span></span><br><span class="line">    <span class="keyword">this</span>.initAttributes();</span><br><span class="line">    <span class="comment">// 然后控制跳转</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.interstitial != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.interstitial.load();</span><br><span class="line">      <span class="keyword">this</span>.interstitial.show(</span><br><span class="line">            anchorType: AnchorType.bottom,</span><br><span class="line">            anchorOffset: <span class="number">0.0</span>,</span><br><span class="line">          );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目比较简单, 但是编写的过程中也遇到了许多问题, 慢慢解决的过程也学到了挺多.</p>
<h4 id="一些资源"><a href="#一些资源" class="headerlink" title="一些资源"></a>一些资源</h4><p><a href="https://github.com/HJMengx/public-apis" target="_blank" rel="noopener">Public APIs</a><br><a href="https://github.com/HJMengx/DogAndCat/" target="_blank" rel="noopener">代码地址</a></p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/05/30/遗传算法/" itemprop="url">遗传算法</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-05-30T15:27:50.957Z" itemprop="datePublished">May 30 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 minutes read (About 1052 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h3 id="遗传算法"><a href="#遗传算法" class="headerlink" title="遗传算法"></a>遗传算法</h3><p>1、遗传算法理论的由来</p>
<p>2、生物学的启发</p>
<p>3、遗传算法定义</p>
<p>4、遗传算法具体步骤</p>
<pre><code>* 初始化
* 适应度函数
* 选择
* 交叉
* 变异</code></pre><p>5、遗传算法的应用</p>
<pre><code>* 特征选取</code></pre><h4 id="类比"><a href="#类比" class="headerlink" title="类比"></a>类比</h4><p>我们先假设一个情景，现在你是一国之王，为了让你的国家免于灾祸，你实施了一套法案：</p>
<pre><code>1. 你选出所有的好人，要求其通过生育来扩大国民数量。
2. 这个过程持续进行了几代。
3. 你将发现，你已经有了一整群的好人。</code></pre><p>这个例子虽然不太可能，但是我用它是想帮助你理解概念。也就是说，我们改变了输入值（比如：人口），就可以获得更好的输出值（比如：更好的国家）。现在，我假定你已经对这个概念有了大致理解，认为遗传算法的含义应该和生物学有关系。那么我们就快速地看一些小概念，这样便可以将其联系起来理解。</p>
<h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><p>回到前面讨论的那个例子，并总结一下我们做过的事情。</p>
<ol>
<li>首先，我们设定好了国民的初始人群大小。</li>
<li>然后，我们定义了一个函数，用它来区分好人和坏人。</li>
<li>再次，我们选择出好人，并让他们繁殖自己的后代。</li>
<li>最后，这些后代们从原来的国民中替代了部分坏人，并不断重复这一过程。</li>
</ol>
<p>遗传算法实际上就是这样工作的，也就是说，它基本上尽力地在某种程度上模拟进化的过程。</p>
<p>因此，为了形式化定义一个遗传算法，我们可以将它看作一个优化方法，它可以尝试找出某些输入，凭借这些输入我们便可以得到最佳的输出值或者是结果。遗传算法的工作方式也源自于生物学，具体流程见下图：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fx8td8y179j309j0dmmxl.jpg" alt></p>
<p>算法的思想是非常简单的, 但是作用却是非常大的.</p>
<h2 id="从一个实际问题来求解"><a href="#从一个实际问题来求解" class="headerlink" title="从一个实际问题来求解."></a>从一个实际问题来求解.</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><table>
<thead>
<tr>
<th align="center">名字\属性</th>
<th align="center">重量/kg</th>
<th align="center">价值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">睡袋</td>
<td align="center">15</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">绳子</td>
<td align="center">3</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">折叠刀</td>
<td align="center">2</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">火把</td>
<td align="center">5</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">瓶子</td>
<td align="center">9</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">葡萄糖</td>
<td align="center">20</td>
<td align="center">17</td>
</tr>
</tbody></table>
<p>有一个可以装30kg的背包, 怎么装效益最高.</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"># 背包问题求解(动态规划也是求解这种问题的一个好方法)</span><br><span class="line"></span><br><span class="line">max_weights = 30</span><br><span class="line"></span><br><span class="line">weights = np.array([15, 3, 2, 5, 9, 20])</span><br><span class="line"></span><br><span class="line">values = np.array([15, 7, 10, 5, 8, 17])</span><br><span class="line"></span><br><span class="line">## 随机初始化一个族群</span><br><span class="line">features = len(weights)</span><br><span class="line"># 初始样本数</span><br><span class="line">init_sample_nums = np.random.randint(int(2 ** features / 3), 2 ** features)</span><br><span class="line">samples = np.ones((init_sample_nums, features))</span><br><span class="line"># 随机给定特性(基因)</span><br><span class="line">for sample in range(init_sample_nums):</span><br><span class="line">    probs = np.random.normal(0, 1, features) &gt; 0.5</span><br><span class="line">    random_sample = np.zeros((features, ))</span><br><span class="line">    random_sample[probs] = 1</span><br><span class="line">    samples[sample] = random_sample</span><br><span class="line"></span><br><span class="line"># 定义函数去筛选</span><br><span class="line">## 筛选, 去除超过总重量的</span><br><span class="line">def remove_the_not_fitness_sample(samples):</span><br><span class="line">    total_weights = np.sum(samples, axis=1)</span><br><span class="line">    not_fitness = total_weights &gt; 30</span><br><span class="line">    # 保留下来的</span><br><span class="line">    fitness = samples[~not_fitness]</span><br><span class="line">    return fitness</span><br><span class="line"></span><br><span class="line"># 评分函数</span><br><span class="line">###  用于族内对比 </span><br><span class="line">def compare_score(samples, remove=2):</span><br><span class="line">    # 如果直接通过最高评分判断</span><br><span class="line">    scores = np.zeros((len(samples, )))</span><br><span class="line">    for sample_index in range(len(samples)):</span><br><span class="line">        has_feature_index = samples[sample_index] == 1</span><br><span class="line">        scores[sample_index] = np.sum(weights[has_feature_index])</span><br><span class="line">    # 排分</span><br><span class="line">    # 从小到大</span><br><span class="line">    sort_scores = np.argsort(scores)</span><br><span class="line">    # 默认剔除最小的两个</span><br><span class="line">    return samples[sort_scores[2:]]</span><br><span class="line">    </span><br><span class="line">## 杂交</span><br><span class="line">def crossover(samples, pairs=5, feature_prob=0.5):</span><br><span class="line">    # 随机选取样本开始杂交</span><br><span class="line">    # 每一次随机选择5对开始杂交</span><br><span class="line">    features = len(samples[0])</span><br><span class="line">    copy_samples = np.copy(samples)</span><br><span class="line">    for pair_index in range(pairs):</span><br><span class="line">        selected = np.random.choice(range(len(samples)), 2)</span><br><span class="line">        # 每一个位置的Gene有多大的可能性会进行杂交</span><br><span class="line">        cross_indexes = np.random.normal(0, 1, features) &gt; feature_prob</span><br><span class="line">        print(cross_indexes, selected)</span><br><span class="line">        for cross_index in range(len(cross_indexes)):</span><br><span class="line">            if cross_indexes[cross_index]:</span><br><span class="line">                samples[selected[0]][cross_index] = samples[selected[1]][cross_index]</span><br><span class="line">        copy_samples = np.append(copy_samples, samples[selected], axis=0)</span><br><span class="line">    return copy_samples</span><br><span class="line"></span><br><span class="line">## 变异</span><br><span class="line">def mutation(samples, feature_unmutation_prob=0.8):</span><br><span class="line">    # 每个基因(feature)的变异几率为0.2</span><br><span class="line">    for sample in samples:</span><br><span class="line">        for feature in range(len(sample)):</span><br><span class="line">            if np.random.normal(0, 1, 1) &gt; feature_unmutation_prob:</span><br><span class="line">                sample[feature] = 0 if sample[feature] else 1</span><br><span class="line">    return samples</span><br><span class="line"></span><br><span class="line"># 执行生物论</span><br><span class="line">fitness = remove_the_not_fitness_sample(samples)</span><br><span class="line">filter_samples = compare_score(samples)</span><br><span class="line">crossover_samples = crossover(filter_samples)</span><br><span class="line">mutation_samples = mutation(crossover_samples)</span><br></pre></td></tr></table></figure>


    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/05/30/hello-world/" itemprop="url">Hello World</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-05-30T15:08:02.187Z" itemprop="datePublished">May 30 2019</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            a minute read (About 121 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

    
    </div>
    
    
</article>




    
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2019 HJMengx&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("default");
</script>



<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>